# Отчёт о выполнении задачи "Secure-dron"

- [Отчёт о выполнении задачи "secure-dron"](#отчёт-о-выполнении-задачи-secure-dron)
  - [Постановка задачи](#постановка-задачи)
  - [Известные ограничения, примечания и вводные данные](#известные-ограничения-примечания-и-вводные-данные)
    - [Цели и Предположения Безопасности (ЦПБ)](#цели-и-предположения-безопасности-цпб)
  - [Архитектура работы системы](#архитектура-работы-системы)
    - [Компоненты](#компоненты)
    - [Алгоритм работы решения](#алгоритм-работы-решения)
    - [Описание Сценариев (последовательности выполнения операций), при которых ЦБ нарушаются](#описание-сценариев-последовательности-выполнения-операций-при-которых-цб-нарушаются)
      - [Негативный сценарий 1. "Чужое" задание](#негативный-сценарий-1-"чужое"-задание)
      - [Негативный сценарий 2. Повторное задание](#негативный-сценарий-2-повторное-задание)
      - [Негативный сценарий 3. Бездействие компонента](#негативный-сценарий-3-бездействие-компонента)
      - [Негативный сценарий 4. Code injection](#негативный-сценарий-4-code-injection)
      - [Негативный сценарий 5. Атака на зависимости](#негативный-сценарий-5-атака-на-зависимости)
      - [Негативный сценарий 6. Брутфорс](#негативный-сценарий-6-брутфорс)
      - [Негативный сценарий 7. Фишинг/MITM](#негативный-сценарий-7-фишинг/mitm)
      - [Негативный сценарий 8. Атака на mobile](#негативный-сценарий-8-атака-на-mobile)
      - [Негативный сценарий 9. DDOS](#негативный-сценарий-9-ddos)
      - [Сводная таблица негативных сценариев](#сводная-таблица-негативных-сценариев)
    - [Указание "доверенных компонент" на архитектурной диаграмме с обоснованием выбора.](#указание-доверенных-компонент-на-архитектурной-диаграмме-с-обоснованием-выбора)
    - [Известные проблемы реализации](#известные-проблемы-реализации)
    - [Политики безопасности](#политики-безопасности)
  - [Запуск приложения и тестов](#запуск-приложения-и-тестов)
    - [Запуск приложения](#запуск-приложения)
    - [Запуск тестов](#запуск-тестов)

## Постановка задачи
Необходимо создать программное обеспечение (далее – ПО) для беспилотного летательного аппарата (далее – дрон), с помощью которого можно обеспечить безопасное управление через мобильное приложение (далее - МП)
или управляющий центр (далее – УЦ) и выполнение задач дроном. К задачам дрона относим: распыление пестицидов или удобрений (далее – смесь) по заданному участку или сброс нужного количества смеси в конкретных координатах.

## Известные ограничения, примечания и вводные данные:
1. По условиям организаторов должна использоваться микросервисная архитектура и шина обмена сообщениями для реализации асинхронной работы сервисов.
2. Обмен данными с УЦ: прием и отправка сообщений.
3. Между собой сервисы общаются через шину сообщений (message bus), а всё снаружи принимают в виде REST запросов.
4. Выполнение команд, принятых от мобильного приложения и УЦ.
5. Геолокация: позиционирование на местности по двум системам - GPS (спутниковая навигационная система) и ИНС (инерциальная навигационная система).
6. Автономность: выполнение программы распыления смеси, защита в случае попытки перехвата управления или многократных попыток передачи некорректных сообщений, действия в случае потери связи. Дрон должен выполнять полётное задание в случае утраты связи с УЦ и МП в условиях отсутствия аварий.
7. Контроль: уровень заряда, количество смеси, обработка территории, распознавание живых объектов (животных и людей), поломка. В случае критических проблем дрон должен вернуться на базу.
8. Мониторинг происходящего на земле: распыление смеси только на землю или растения.
9. Возврат на базу в случае нештатных ситуаций (в т.ч. в случае сбоя GPS). База имеет фиксированные координаты (x0,y0,z0),
возврат происходит с использованием ИНС (инерциальной навигационной системы). В отсутствие GPS возврат на базу без распыления.
10. ИНС является автономной навигационной системой, но накапливает ошибку, поэтому должна использоваться только в случае сбоя GPS.
11. Из-за внешних обстоятельств GPS навигация может быть невозможной, это необходимо учитывать в решении.
12. Мониторинг происходящего может быть реализован как простой сервис, выдающий состояние "можно распылять" или "нельзя распылять"
13. Надёжность аппаратуры не учитывается
14. Смесь не имеет массы и объёма.
15. Графический интерфейс для взаимодействия с пользователем не требуется, достаточно примеров REST запросов.
16. Приборная точность позиционирования достаточна для выполнения полётного задания.
17. Поле имеет прямоугольную форму и задается в формате x1,y1,z1 (ближний к базе угол) и x2, y2, z2 (дальний от базы угол).


### Цели и Предположения Безопасности (ЦПБ)
**Бизнес-цель:**
  - Выполнение задачи по опылению и/или безопасное возвращение на базу.

**Цели безопасности:**
1. Обеспечение безопасности дрона от перехвата управления.
2. Получение задания только от корпоративного сервера.
3. В случае многократных попыток неавторизованного доступа вернуться на базу.
4. При потере соединения с gps, прекратить опыление и вернуться на базу.
5. Неопыление чего-либо кроме указанного в задании поля.

**Предположения безопасности:**
Целями безопасности дрона не являются:
1. Защита от атак с использованием физического доступа (к чему угодно - дрону, МП, УЦ)
2. Защита от намеренного искажения GPS координат
3. Защита от сетевых атак - т.е. MITM между сетевыми компонентами - дроном, мобильным приложением и УЦ

## Архитектура работы системы
![DFD](./pics/dfd.png?raw=true "Архитектура")

### Компоненты

Изначально заказчик предусматривал следующую структуру:

| Название | Назначение | Комментарий |
|----|----|----|
|*Управляющий центр / Control Center (control)* | Создает полетные задания для дронов. Распределяет полетные маршруты и проверяет их на безопасность с точки зрения пересечения. Ведет реестр ошибок и аварийных ситуаций. Регистрирует результаты выполнения полетных заданий. Взаимодействует с дроном через API. |  |
|*Мобильное приложение / Mobile Application (mobile)* | Получает информацию о состоянии дрона в течении всего периода взаимодействия/ управления полетом. Передает дрону различные команды (запуск, возвращение на базу). Взаимодействует с дроном через API. | |
|*Оператор / Operator (operator)* | Взаимодействует с дроном через API. Использует для авторизации уже известный ему уникальный PIN код (программная реализация механизма передачи PIN кода клиенту не требуется), но этот же PIN код использует и control при отправке задания. | |
|*Управление полетом / Dispatcher (dispatcher)*  | Контролирует состояние дрона. Контролирует исполнение полетного задания. Отслеживает позиционирование дрона в 3D. Поддерживает связь с УЦ и мобильным приложением. В задаче использует только API. | |
|*Инерциальная навигационная система / Inertial Navigation System (ins)* | Ведет GPS-независимую карту полета. Строит аварийный маршрут возвращения на базу. | опционально |
|*GPS (gps)* | Выдаёт текущие координаты (x, y, z). Отслеживает прерывание сигнала. Отслеживает ошибки позиционирования. | |
|*Контроль обстановки / Situation control (situation)* | Контролирует высоту полета. Контролирует появление наземных объектов (люди, животные) в месте распрыскивания смеси. Контролирует состояние датчиков столкновения. | |
|*Опылитель / Sprayer* | Контролирует расход смеси. Отключает и включает распрыскиватель в заданных точках маршрута. Управляет аварийным выключением распрыскивателя. | |
|*Контроль состояния / State control (state)*<br>(монитор безопасности) | Контролирует уровень заряда батареи. Контролирует состояние распрыскивателя. Контролирует уровень смеси (сколько осталось). Контролирует состояние прочих модулей дрона. | |
|*Security monitor*<br>(монитор безопасности) | авторизует операцию, если она удовлетворяет заданным правилам или блокирует её в противном случае | |
|*Message bus* | шина сообщений и брокер - сервис передачи сообщений от источника получателям | kafka+zookeeper | |

Она представляется несколько избыточной, поэтому объединим ins и gps в блок position. Аналогично поступим с state, перенеся его в dispatcher -> это возможно сделать, поскольку смысл компонента в (фактически) мониторинге и
сохранении параметров работы дрона, а управляет этим и обрабатывает ошибки все равно dispatcher.
Кроме того, традиционно вынесем в отдельный модель блок связи с "внешним миром", т.е. с УЦ и МП, назовем его connector.
Пересмотрим функционал "Контроля обстановки" - лишим его контроля высоты и столкновения в пользу более "тематических" модулей, переименуем в recognize - теперь он отвечает за распознавание препятствий и пр. объектов в ходе работы.

Получим следующий набор компонентов:

| Название | Назначение | Комментарий |
|----|----|----|
|*Управляющий центр (control)* | Создает полетные задания для дронов. Распределяет полетные маршруты и проверяет их на безопасность с точки зрения пересечения. Ведет реестр ошибок и аварийных ситуаций. Регистрирует результаты выполнения полетных заданий. Взаимодействует с дроном через API. |  |
|*Мобильное приложение (mobile)* | Получает информацию о состоянии дрона в течении всего периода взаимодействия/ управления полетом. Передает дрону различные команды (запуск, возвращение на базу). Взаимодействует с дроном через API. | |
|*Оператор (operator)* | Взаимодействует с дроном через API. Использует для авторизации уже известный ему уникальный PIN код (программная реализация механизма передачи PIN кода клиенту не требуется), но этот же PIN код использует и control при отправке задания. | |
|*Управление полетом (dispatcher)*  | Контролирует состояние дрона (заряд батареи, состояние распылителя, уровень смеси, датчиков столкновения, иные модули). Контролирует исполнение полетного задания. Отслеживает позиционирование дрона в 3D. Управляет аварийным выключением распрыскивателя. | |
|*Позиционирование (position)* | Ведет GPS-независимую карту полета. Строит аварийный маршрут возвращения на базу. Выдаёт текущие координаты (x, y, z). Отслеживает прерывание сигнала. Отслеживает ошибки позиционирования. Контролирует высоту полета. |  |
|*Распознавание (recognizing)* | Контролирует появление наземных объектов (люди, животные) в месте распрыскивания смеси. | |
|*Опылитель (sprayer)* | Контролирует расход смеси. Отключает и включает распрыскиватель в заданных точках маршрута.  | |
|*Передатчик (connector)* | Поддерживает связь с УЦ и мобильным приложением через HTTP протокол. В задаче использует только API. Передает сообщения дальше в message bus. | |
|*Security monitor*<br>(монитор безопасности) | Авторизует операцию, если она удовлетворяет заданным правилам или блокирует её в противном случае | |
|*Message bus* | Шина сообщений и брокер - сервис передачи сообщений от источника получателям | kafka+zookeeper | |


### Алгоритм работы решения

![Sequence diagram](./pics/sd.png?raw=true "Диаграмма вызовов")

---
Message bus и Security Monitor на диаграммах опущены для лучшей читаемости и уменьшения размера картинки. КАЖДОЕ сообщение внутри системы проходит через monitor, который исходя из политик принимает решение пропустить его или нет.
---

### Описание Сценариев (последовательности выполнения операций), при которых ЦБ нарушаются

Заказчиком были представлены наиболее волнующие его негативные сценарии атаки, разберем их:
 - Физический доступ к смартфону с мобильным приложением. Получен доступ к файловому хранилищу телефона и временным файлам приложения. Таким образом, для стороннего использования доступны разнообразные данные, например данные геолокации, персональные данные, учетные записи, финансовая информация и т.д.
 - Подключение к недоверенному Wi-Fi-роутеру. Атака через канал связи. Перехват всех передаваемых данных, как от смартфона, так и от сервера и дрона, к которому в данный момент обращается. Это открывает возможность для фишинга.
 - Недостаточная защита от подбора учетных данных (подбор PIN-кода), которая может привести к компрометации данных и финансовым потерям. Например, можно дать команду дрону выпустить все пестициды над водной поверхностью: река, озеро. И пестициды попадут в водозабор, потравят рыбу и распространятся дальше по руслу реки.
 - Глушение канала передачи информации мобильное приложение <-> дрон (gsm, wifi, ic и т.п.). При отсутствии реализованного аварийного сценария поведения дрона может быть сорвана обработка поля. Например, если поднять дрон высоко, то пестициды ветром разнесет далеко за границы опрыскиваемого участка. Также возможна физическая потеря дрона от столкновения, если его направить на какой-либо объект инфраструктуры.
 - Перехват команды/полетного задания и внедрение в него недостоверной информации. Таким образом, доступна подмена пакета при передаче через промежуточные звенья и возможен перехват управления дроном. В том числе, через дрон возможно взломать центр управления и сфальсифицировать все полетные задания. Одна емкость с химикатами особо может ни на что не повлияет, а если скрытно почти незаметно вмешиваться в работу, так чтобы это не сразу отследили, то можно за десятки и сотни вылетов диверсию осуществлять.
 - DDOS атака на сервера УЦ несет за собой финансовые потери.

Рассматривая их детально были сделаны следующие выводы:
 - Физический доступ к смартфону предотвратить не удастся, следовательно, его необходимо делать защищенным - т.е. использовать для блокировки сложные пароли/биометрические данные, можно даже использовать виртуализацию и прочие методы защиты на Android, чтобы сломать злоумышленнику мозг и усложнить жизнь.
 - Перехват данных действительно может быть проблемой, поэтому предполагается e2e шифрование между дроном, мобильным приложением и управляющим центром.
 - Для предотвращения этого было реализовано ограничение на количество попыток ввода пароля.
 - При глушении связи с оператором ничего не произойдет, а вот при потере связи с gps, осуществляется автоматическая блокировка распылителя и возврат на базу.
 - Для борьбы с данной угрозой было принято решение осуществлять подтверждение задания не только паролем и сквозным шифрованием, но и оператором через мобильное приложение, при чем, свое задание предоставляет дрон, т.е. схема выглядит как control -[task]> dispatcher -[task]> mobile -[confirmation]> dispatcher. Вопрос передачи от control к mobile задания остается за кадром.

Кроме того, поскольку УЦ, вероятно, физически представляет из себя что-то навроде серверной - он находится где-то в офисе, где есть контроль доступа и соответствующие службы безопасности (физической и информационной), поэтому детальное описание мер по недопущению доступа к УЦ и его DDOS и прочего оставим на их совести, а сами реализуем схему общения между собой dispatcher <- control <-> mobile <-> dipatcher, поскольку она и позволит применить лучшие практики для обеспечения безопасной коммуникации между двумя устройствами, а так же добавит буфер в виде mobile, где можно развернуть дополнительные меры безопасности.

Рассмотрим детальнее компоненты системы:
По заданию доверенные и надежные компоненты - **message bus** и **monitor**. При этом считается, что все сообщения безальтернативно идут через **monitor**, который применяет политики безопасности.
Поскольку запланирована валидация команд оператором, то становится возможным не делать доверенным УЦ (**control**), что так же частично закрывает проблему фишинга, но при это требования к **mobile** повышаются вплоть до объявления его доверенным.
Компонент **dispatcher** определенно должен быть доверенным как управляющий модуль дрона. Кроме того, блок позиционирования обеспечивает выполнение ЦБ, поэтому ему так же хочется доверять -> он тоже будет доверенным.
Остаются компоненты **recognizing** и **sprayer**. **Sprayer** может не быть доверенным, поскольку было принято решение вывести аналоговый датчик уровня топлива в блок остальных параметров **dispatcher**, т.е. при начале несанкционированной работы в процессе полета, диспетчер это заметит и физически заблокирует взломанный компонент.
С **recognizing** так не получится, а кроме того, его некорректная работы может нарушить ЦБ №5, но я считаю это приемлемым риском за невключение компонента в доверенные. Почему? Потому что при выполнении остальных политик опыляться будет все равно только указанное поле в указанных координатах (в т.ч. высотных), поэтому для снижения затрат могу предложить добавить второй блок распознавания и действовать по операции ИЛИ, ну, или прикрепить сирену к дрону - виу-виу-виу, коровы и люди будут сами убегать в ужасе.

В результате произведенных над ней размышлений, наиболее вероятные сценарии нарушения ЦБ практически не изменились:
1. Заказ прислан злоумышленником и/или взлом connector; **авторизация + меры безопасности**
2. Прислан повторный заказ; **реализована блокировка таковой возможности**
3. Какой-то компонент взломан и саботирует работу - простаивает; **тут все еще надо плакать**
4. Скрытые поля и их использование для code injections; **частично реализована валидация, экранирование**
5. Атака на "зависимости" - закладки в стороннем ПО, библиотеках; **локальные копии + проверка обновлений**
6. Неограниченное количество попыток на ввод пароля **реализована проверка с ограниченным количеством попыток**
7. Атака на **mobile** **out-of-scope, но описаны требования и предложения**
8. Фишинг **e2e шифрование, на данный момент для упрощения реализовано простыми паролями**
9. DDOS **при осуществлении атаки monitor может просто октлючить connector, т.к. задачей предусмотрено автономное выполнение работы, т.е. потенциальная временная потеря связи с mobile и УЦ является приемлимой**

Здесь необходимо сделать ремарку, что концепция сохранения локальных копий используемых библиотек и проверки только поступающих обновлений подразумевает идею о том, что в условиях разработанной архитектуры простая эксплуатация уже существующей уязвимости в компоненте не позволит выйти за его пределы, т.к. если это и возможно, то потребуется доступ на уровне RCE, т.е. злоумышленнику все равно придется как-то доставлять код во взломанный компонент, поэтому сделан специальный **connector** в качестве буфера перед системой и **monitor**, который позволяет осуществлять валидацию.

В результате, в текущей реализации системы наиболее вероятным представляется невыполнение бизнес-функции в результате атаки на дрон при соблюдении всех заявленных ЦБ.

![Негативные сценарии](./pics/sd_risks.png?raw=true "Негативные сценарии")

### Негативный сценарий 1. "Чужое" задание
![Негативные сценарии](./pics/sd_1.png?raw=true "")

Нарушается цель безопасности №2.
Компенсируется использованием авторизации (реализовано "для вида") и криптографии + меры защиты на уровне сети и системы (out of scope).

### Негативный сценарий 2. Повторное задание
![Негативные сценарии](./pics/sd_2.png?raw=true "")

Нарушается цель безопасности №1,2,5.
Данная возможность заблокирована - после приема первой задачи до ее выполнения успешного или нет, новые задачи отклоняются.

### Негативный сценарий 3. Бездействие компонента
![Негативные сценарии](./pics/sd_3.png?raw=true "")

Нарушается Бизнес-функция.
Компенсация представляется невозможной.

### Негативный сценарий 4. Code injection
![Негативные сценарии](./pics/sd_4.png?raw=true "")

Нарушается цель безопасности №1,5.
Компенсируется использованием строгой валидации входных данных в систему, дополнительным контролем друг друга модулями, частично реализовано.

### Негативный сценарий 5. Атака на зависимости
![Негативные сценарии](./pics/sd_5.png?raw=true "")

Нарушается цель безопасности №1,5.
Компенсируется использованием локальных копий сторонних библиотек, проверкой устанавливаемых библиотек.

### Негативный сценарий 6. Брутфорс
![Негативные сценарии](./pics/sd_6.png?raw=true "")

Нарушается цель безопасности №1,2,3.
Реализована проверка пароля только ограниченное число раз, при ошибке - возврат на базу и отмена задания.

### Негативный сценарий 7. Фишинг/MITM
![Негативные сценарии](./pics/sd_7.png?raw=true "")

Нарушается цель безопасности №1,2.
Компенсируется использованием e2e шифрования и прочих мер защиты передачи информации. На данный момент для вида реализовано заголовками аутентификации и паролями в теле.

### Негативный сценарий 8. Атака на mobile
![Негативные сценарии](./pics/sd_8.png?raw=true "")

Нарушается цель безопасности №1,2.
Mobile является доверенным компонентом, не менее важным, чем dispathcer и атаки на него хоть и выходят за рамки рассматриваемых в работе, но должны быть упомянуты, как имеющие важные последствия.

### Негативный сценарий 9. DDOS
![Негативные сценарии](./pics/sd_9.png?raw=true "")

Нарушается цель безопасности №3.
Компенсируется временным отключением компонента Connector от сети, чтобы не перегружать внуренние слабые вычилительные мощности дрона. Альтернатива - при перегрузке и отключении monitor (а сообщения будут падать в него) иметь цепь перезагрузки monitor.

#### Сводная таблица негативных сценариев*

|№  | Название | Скомпрометированная/Атакованная часть системы | Нарушенная цель безопасности |
|----|----|----|----|
|1 | "Чужое" задание | Connector, Dispatcher | 2 |
|2 | Повторное задание | Connector | 1,2,5 |
|3 |  Бездействие компонента  | Any untrusted | - |
|4 | Code injection | Any untrusted | 1,5 |
|5 | Атака на зависимости | Any | 1,5 |
|6 |  Брутфорс  | Connector, Dispatcher | 1,2,3 |
|7 | Фишинг/MITM | Mobile/Control -> Connector | 1,2 |
|8 | Атака на mobile | Mobile | 1,2 |
|9 |  DDOS  | Connector | 3 |

### Указание "доверенных компонент" на архитектурной диаграмме.

В предыдущем параграфе были рассмотрены возможные сценарии нарушения ЦБ, по результатам чего были определены доверенные компоненты - **monitor**, **message bus**, **position**, **mobile** и **dispatcher**, по причине того, что шина обмена сообщений и монитор безопасности являются общесистемными, а также мы хотим доверять результатам работы блока управления дроном, его модулю позиционирования и командному приложению оператора.

![DFD-TCB](./pics/dfd_stepan_trusted.png?raw=true "Доверенные компоненты")

Теоретически, шину обмена сообщениями можно сделать недоверенным компонентом, но тогда необходимо будет реализовать механим верификации сообщений. Например, можно использовать технологию типа blockchain.
Цена этого изменения - усложнение обмена сообщениями, дополнительные накладные расходы на верификацию, снижение производительности системы, возможно также возникновение нестабильности и различные ситуации гонок.

### Известные проблемы реализации
- Не реализованы вызовы прерывания "препятствие"
- Не реализованы вызовы прерывания "ошибка GPS"
- Не реализовано межпоточное обновление координат во время движения (в реальности это независимые датчики, но в коде требовалось бы связать два разных контейнера, чтобы обновлять координаты прямо во время выполнения кода движения, поэтому на данный момент синхронизация реализована как окончание каждого этапа движения)
- Не реализована фактическая отправка ответов на сервер (проблемы с сетью между docker контейнерами)
Тем не менее, указанные недоработки проработаны в архитектуре и частично в коде и, соответсвенно, предусмотренны и могут быть добавлены за доп. время.

### Политики безопасности
```python {lineNo:true}
import time
from producer import proceed_to_deliver


ordering = False
activated = False

def check_operation(id, details):
    global ordering
    global activated
    authorized = False

   # print(f"[info] checking policies for event {id},"\
   #       f" {details['source']}->{details['deliver_to']}: {details['operation']}")
    src = details['source']
    dst = details['deliver_to']
    operation = details['operation']

    if not activated:
      if src == 'connector' and dst == 'dispatcher' \
         and operation == 'activate':
            activated = True
            authorized = True    
    else:
        if src == 'connector' and dst == 'monitor' \
            and operation == 'deactivate':
            activated = False
            authorized = True  

    if activated:
        if not ordering:
            if  src == 'connector' and dst == 'dispatcher' \
                and operation == 'task' and len(details) == 12 :
                authorized = True
        else:
            det = details.copy()
            det['operation'] = 'reject'
            det['deliver_to'] = 'monitor'
            print('rejected')
            proceed_to_deliver(det['id'], det)
            time.sleep(1)
                #todo check content of another fields
        if src == 'dispatcher' and dst == 'position' \
            and operation == 'move_to':
            authorized = True  
        if src == 'dispatcher' and dst == 'position' \
            and operation == 'where_am_i':
            authorized = True    
        if src == 'dispatcher' and dst == 'sprayer' \
            and operation == 'stop':
            authorized = True  
        if src == 'dispatcher' and dst == 'sprayer' \
            and operation == 'start':
            authorized = True    
        if src == 'dispatcher' and dst == 'connector' \
            and operation == 'ask_task':
            authorized = True
        if  src == 'dispatcher' and dst == 'connector'\
            and operation == 'error':
            authorized = True
        if  src == 'dispatcher' and dst == 'position'\
            and operation == 'nonexistent':
            authorized = True
        if  src == 'dispatcher' and dst == 'position'\
            and operation == 'nonexistent2':
            authorized = True
        if  src == 'dispatcher' and dst == 'connector'\
            and operation == 'operation_status':
            authorized = True
            ordering = False

        if  src == 'position' and dst == 'dispatcher'\
            and operation == 'parameters':
            authorized = True
        if  src == 'position' and dst == 'dispatcher'\
            and operation == 'spraying':
            authorized = True
        if  src == 'position' and dst == 'dispatcher'\
            and operation == 'operation_status':
            authorized = True
        if  src == 'position' and dst == 'dispatcher'\
            and operation == 'coordinates':
            authorized = True

        if  src == 'recognizer' and dst == 'dispatcher'\
            and operation == 'obstruction':
            authorized = True

    return authorized


```

## Запуск приложения и тестов

### Запуск приложения

см. [инструкцию по запуску](../../README.md)

### Запуск тестов

_Предполагается, что в ходе подготовки рабочего места все системные пакеты были установлены._

Запуск примера: открыть окно терминала в Visual Studio code, в папке drone с исходным кодом выполнить

**make run**
или **docker-compose up -d**

Примечание: сервисам требуется некоторое время для начала обработки входящих сообщений от kafka, поэтому перед переходом к тестам следует сделать паузу 1-2 минуты
Примечание 2: контейнер broker имеет свойство падать при запуске, поэтому спустя секунд 15 после запуска make run имеет смысл проверить, находится ли он в состоянии UP и в случае чего повторно его запустить.


запуск тестов:
**make test**
или **pytest**

Будут выполнены 8 тестов, 5 на корректность работы, 3 на безопасность, рассчетное время выполнения ~ 5 минут 45 секунд.
Ожидаемый результат выглядит следующим образом (на слайде так же присутсвует отладочная информация - при вашем запуске ее не будет):


![Tests](./pics/tests.png?raw=true "Тесты")
